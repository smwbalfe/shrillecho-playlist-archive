FROM node:21-alpine3.18

WORKDIR /app

COPY ./package*.json ./

COPY ./yarn.lock ./
RUN yarn install

COPY ./ ./

ARG NEXT_PUBLIC_SUPABASE_URL
ARG NEXT_PUBLIC_SUPABASE_ANON_KEY
ARG NEXT_PUBLIC_GO_API
ARG NEXT_PUBLIC_WEBSOCKET_API
ENV NEXT_PUBLIC_SUPABASE_URL=$NEXT_PUBLIC_SUPABASE_URL
ENV NEXT_PUBLIC_SUPABASE_ANON_KEY=$NEXT_PUBLIC_SUPABASE_ANON_KEY
ENV NEXT_PUBLIC_GO_API=$NEXT_PUBLIC_GO_API
ENV NEXT_PUBLIC_WEBSOCKET_API=$NEXT_PUBLIC_WEBSOCKET_API

RUN yarn run build
CMD ["yarn", "start"]